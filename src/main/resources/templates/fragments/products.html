<div id="products-fragment" class="bg-gray-50 min-vh-100" th:fragment="products">
    <!-- Cabeçalho Integrado -->
    <div class="bg-white shadow-sm">
        <div class="container-fluid px-4 py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0 text-gray-800">
                    <i class="fas fa-box-open me-2"></i>Nossos Produtos
                </h1>
                <div>
                    <a th:href="@{/customer}" class="btn btn-outline-primary btn-sm me-2">
                        <i class="fas fa-user-circle me-1"></i> Minha Conta
                    </a>
                    <a th:href="@{/logout}" class="btn btn-outline-danger btn-sm">
                        <i class="fas fa-sign-out-alt me-1"></i> Sair
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <main class="container-fluid py-4">
        <!-- Filtros e Ordenação - Versão Funcional -->
        <div class="card mb-4 border-0 shadow-sm">
            <div class="card-body py-3">
                <form th:action="@{/products}" method="get" id="filterForm">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-4">
                            <label for="category" class="form-label">Filtrar por Categoria</label>
                            <select class="form-select" name="category" id="category">
                                <option value="">Todas Categorias</option>
                                <option th:each="category : ${categories}" 
                                        th:text="${category}" 
                                        th:value="${category}"
                                        th:selected="${category == selectedCategory}"></option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="size" class="form-label">Itens por página</label>
                            <select class="form-select" name="size" id="size">
                                <option th:each="i : ${#numbers.sequence(5, 25, 5)}" 
                                        th:text="${i}" 
                                        th:value="${i}"
                                        th:selected="${i == pageSize}"></option>
                            </select>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-filter me-2"></i>Aplicar Filtros
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lista de Produtos -->
        <div class="row g-4">
            <div th:each="product : ${products}" class="col-12 col-sm-6 col-md-4 col-lg-3 my-fixed-height-col">
                <div class="card h-100 border-0 shadow-sm hover-shadow transition-all">
                    <div class="position-relative" style="height: 200px; overflow: hidden;">
                        <img th:src="${product.image}" 
                             th:alt="${product.title}" 
                             class="card-img-top h-100 w-100 object-fit-cover">
                        <div class="position-absolute top-0 end-0 m-2">
                            <span class="badge bg-success">Novo</span>
                        </div>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-truncate" th:text="${product.title}"></h5>
                        <p class="text-muted small mb-2" th:text="${product.category}"></p>
                        <p class="card-text text-truncate-3 mb-3" 
                           th:text="${product.description}"></p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <h5 class="text-primary mb-0" 
                                th:text="${'R$ ' + #numbers.formatDecimal(product.price, 1, 2, 'POINT')}"></h5>
                            <div class="input-group input-group-sm" style="width: 120px;">
                                <select class="form-select form-select-sm" th:id="'quantity-' + ${product.id}">
                                    <option th:each="i : ${#numbers.sequence(1, 5)}" 
                                            th:value="${i}" 
                                            th:text="${i}"></option>
                                </select>
                                <button class="btn btn-primary btn-sm" 
                                th:data-product-id="${product.id}"
                                th:data-product-price="${product.price}"
                                onclick="addToCart(this)">
                            <i class="fas fa-cart-plus"></i>
                            Adicionar ao carrinho
                        </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paginação -->
        <nav th:if="${totalPages > 1}" class="mt-5">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/products(page=0, size=${pageSize}, category=${selectedCategory})}">
                        <i class="fas fa-angle-double-left"></i>
                    </a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
                    th:classappend="${i-1 == currentPage} ? 'active'">
                    <a class="page-link" 
                       th:href="@{/products(page=${i-1}, size=${pageSize}, category=${selectedCategory})}"
                       th:text="${i}"></a>
                </li>
                <li class="page-item" th:classappend="${currentPage == totalPages-1} ? 'disabled'">
                    <a class="page-link" 
                       th:href="@{/products(page=${totalPages-1}, size=${pageSize}, category=${selectedCategory})}">
                        <i class="fas fa-angle-double-right"></i>
                    </a>
                </li>
            </ul>
        </nav>
    </main>
</div>